# Production Deployment - Complete Guide

This guide shows you how to deploy a production Xray server and connect any VLESS client.

## ğŸ“ What Was Created

All production-ready deployment files are in the `deploy/` directory:

```
deploy/
â”œâ”€â”€ QUICKSTART.md              # 5-minute quick start guide
â”œâ”€â”€ DEPLOYMENT.md              # Detailed step-by-step guide
â”œâ”€â”€ README.md                  # Feature overview
â”‚
â”œâ”€â”€ server/                    # ğŸ–¥ï¸ SERVER DEPLOYMENT
â”‚   â”œâ”€â”€ Dockerfile             # Production server image
â”‚   â”œâ”€â”€ docker-compose.yml     # Server orchestration
â”‚   â”œâ”€â”€ .env.example           # Configuration template
â”‚   â”œâ”€â”€ config.template.json   # Server config template
â”‚   â”œâ”€â”€ setup.sh               # Automated setup script â­
â”‚   â”œâ”€â”€ generate-keys.sh       # REALITY key generator
â”‚   â””â”€â”€ generate-vless-url.sh  # VLESS URL generator â­
â”‚
â””â”€â”€ client/                    # ğŸ“± CLIENT DEPLOYMENT
    â”œâ”€â”€ Dockerfile             # Production client image
    â”œâ”€â”€ docker-compose.yml     # Client orchestration
    â”œâ”€â”€ .env.example           # Configuration template
    â”œâ”€â”€ config.template.json   # Client config template
    â””â”€â”€ setup.sh               # Automated setup script â­
```

## ğŸš€ Quick Start (5 Minutes)

### 1ï¸âƒ£ Deploy Server (3 min)

```bash
# On your VPS
git clone https://github.com/xtls/Xray-core.git
cd Xray-core/deploy/server/

# Configure (edit with your server IP)
cp .env.example .env
nano .env  # Set SERVER_ADDRESS=your-ip

# Generate keys and start
./generate-keys.sh  # Type 'y' to save
./setup.sh          # Setup and validate
docker-compose up -d

# Get connection URL
./generate-vless-url.sh
```

**Copy the VLESS URL!** It looks like:
```
vless://uuid@server:443?encryption=none&flow=xtls-rprx-vision&security=reality...
```

### 2ï¸âƒ£ Connect Client (2 min)

#### Option A: GUI Apps (Easiest)

**Windows - v2rayN:**
- Download: https://github.com/2dust/v2rayN/releases
- Import: Servers â†’ Import from Clipboard
- Paste VLESS URL â†’ Connect

**Android - V2RayNG:**
- Install from Play Store
- Tap "+" â†’ Import from Clipboard
- Paste VLESS URL â†’ Connect

**iOS - Shadowrocket:**
- Install from App Store ($2.99)
- Tap "+" â†’ Paste VLESS URL
- Connect

**macOS/Linux - Nekoray:**
- Download: https://github.com/MatsuriDayo/nekoray/releases
- Server â†’ Import from Clipboard
- Connect

#### Option B: Docker Client (Linux)

```bash
cd Xray-core/deploy/client/
./setup.sh 'vless://your-url-here'
docker-compose up -d

# Test
curl -x socks5://127.0.0.1:10808 https://ifconfig.me
```

## âœ… What You Get

Your deployment includes:

1. **VLESS Protocol**
   - Lightweight and fast
   - Better than VMess/Shadowsocks

2. **REALITY (TLS Camouflage)**
   - Looks like real HTTPS traffic
   - Mimics major websites (Microsoft, Apple, etc.)
   - Extremely hard to detect

3. **Vision (XTLS Flow)**
   - Advanced traffic flow control
   - Reduces characteristic TLS-in-TLS patterns

4. **Statistical Obfuscation**
   - HTTP/3 packet size distribution
   - Exponential timing jitter
   - HTTPS-like burst patterns
   - **Specifically designed to evade Russia/Iran DPI**

5. **Production Ready**
   - Dockerized with auto-restart
   - Logging and monitoring
   - Easy updates and management

## ğŸ”§ Configuration Details

### Server Configuration (.env)

```bash
# Your server's public IP or domain
SERVER_ADDRESS=123.45.67.89

# Port (443 = HTTPS, looks normal)
XRAY_PORT=443

# Generated automatically
CLIENT_UUID=<auto-generated>
REALITY_PRIVATE_KEY=<auto-generated>
REALITY_PUBLIC_KEY=<auto-generated>

# What website to mimic
REALITY_DEST=www.microsoft.com:443
REALITY_SERVER_NAMES=www.microsoft.com,www.bing.com

# Short IDs (leave as default)
REALITY_SHORT_IDS=,0123456789abcdef
```

### Popular REALITY Targets

- **Microsoft**: `www.microsoft.com:443` (recommended)
- **Apple**: `www.apple.com:443`
- **Cloudflare**: `www.cloudflare.com:443`
- **Amazon**: `www.amazon.com:443`

Choose based on your server location and what traffic looks normal there.

## ğŸ“Š Testing

### Verify Server

```bash
# Check server is running
cd deploy/server/
docker-compose ps
docker-compose logs -f

# Check port is open (from outside)
nc -zv your-server-ip 443
```

### Verify Client

```bash
# Test connection (desktop/mobile apps)
# Just open browser â†’ https://www.google.com

# Test Docker client
curl -x socks5://127.0.0.1:10808 https://www.google.com

# Check your IP (should show server IP)
curl -x socks5://127.0.0.1:10808 https://ifconfig.me

# Speed test
curl -x socks5://127.0.0.1:10808 -o /dev/null \
  https://speed.cloudflare.com/__down?bytes=100000000
```

## ğŸ” Security Features

1. **Strong Encryption**: TLS 1.3 with REALITY
2. **Perfect Forward Secrecy**: New keys per session
3. **Traffic Obfuscation**: Statistical anti-DPI measures
4. **Domain Fronting**: Via REALITY camouflage
5. **No Logs**: Minimal logging by default

## ğŸ› ï¸ Management

### Server Management

```bash
cd deploy/server/

# View logs
docker-compose logs -f

# Restart server
docker-compose restart

# Stop server
docker-compose stop

# Update Xray
git pull
docker-compose build --no-cache
docker-compose up -d

# View connection stats
docker stats xray-server

# Regenerate VLESS URL
./generate-vless-url.sh
```

### Client Management

```bash
cd deploy/client/

# View logs
docker-compose logs -f

# Restart
docker-compose restart

# Stop
docker-compose stop
```

### Adding More Users

1. Generate new UUID:
```bash
docker run --rm ghcr.io/xtls/xray-core:latest uuid
```

2. Edit server config:
```bash
cd deploy/server/
nano config.json
# Add new client entry to "clients" array
```

3. Restart server:
```bash
docker-compose restart
```

4. Generate VLESS URL for new user:
```bash
# Update .env with new UUID temporarily
CLIENT_UUID=new-uuid ./generate-vless-url.sh
```

## ğŸ› Troubleshooting

### Server Won't Start

```bash
# Check logs
docker-compose logs

# Common issues:
# 1. Port 443 in use â†’ Change XRAY_PORT in .env
# 2. Invalid config â†’ Run ./setup.sh again
# 3. Firewall â†’ sudo ufw allow 443/tcp
```

### Client Can't Connect

```bash
# Test connectivity
ping your-server-ip
nc -zv your-server-ip 443

# Check configuration matches:
# - UUID
# - Public Key
# - Server Name

# Enable debug logs
# In client config.json: "loglevel": "debug"
docker-compose restart
docker-compose logs -f
```

### Slow Connection

- Try closer server location
- Check server bandwidth: `speedtest-cli`
- Try different REALITY target
- Check server load: `docker stats`

## ğŸ“š Documentation

- **QUICKSTART.md** - Fast 5-minute setup
- **DEPLOYMENT.md** - Detailed step-by-step guide
- **README.md** - Feature overview and comparison
- **testing/README.md** - Testing framework documentation
- **research_vpn.md** - Technical research details

## ğŸ”¥ Production Checklist

### Server Setup âœ…
- [ ] VPS with public IP
- [ ] Docker installed
- [ ] Firewall configured (port 443 open)
- [ ] .env configured with server IP
- [ ] REALITY keys generated
- [ ] UUID generated
- [ ] setup.sh completed successfully
- [ ] docker-compose running
- [ ] VLESS URL generated

### Client Setup âœ…
- [ ] Client app installed
- [ ] VLESS URL imported
- [ ] Connection successful
- [ ] Browser works through proxy
- [ ] IP check shows server IP
- [ ] No DNS leaks

### Security âœ…
- [ ] Strong UUID (auto-generated)
- [ ] Unique REALITY keys
- [ ] Firewall enabled
- [ ] Only port 443 open
- [ ] Logs monitored
- [ ] Regular updates scheduled

## ğŸ’¡ Tips

1. **Use domain instead of IP** - More stable, easier to remember
2. **Choose good REALITY target** - Major websites in same region as server
3. **Monitor logs regularly** - Check for errors or suspicious activity
4. **Keep Xray updated** - Run `git pull && docker-compose up -d --build` monthly
5. **Backup configuration** - Save .env and config.json securely
6. **Test from multiple networks** - Mobile, home, work, etc.

## ğŸ†˜ Getting Help

1. **Check logs first**: `docker-compose logs -f`
2. **Read DEPLOYMENT.md**: Detailed troubleshooting
3. **Test connectivity**: `nc -zv server-ip 443`
4. **Verify config**: `docker-compose exec xray xray run -test -c /etc/xray/config.json`
5. **GitHub Issues**: https://github.com/xtls/xray-core/issues

## ğŸ¯ Real-World Usage

### Personal Use
- 1 VPS = $3-5/month
- Supports 5-10 devices
- Full privacy and control

### Family/Friends
- Share VLESS URL
- Add multiple UUIDs
- Each user gets own ID

### Small Organization
- 2GB RAM VPS
- 20-50 concurrent users
- Load balancing with multiple servers

## ğŸŒ Recommended VPS Providers

- **Hetzner** - Best value (â‚¬4.51/mo, 2GB RAM, 20GB SSD)
- **DigitalOcean** - Easy to use ($4/mo, 512MB RAM)
- **Vultr** - Global locations ($3.50/mo, 512MB RAM)
- **Linode** - Reliable ($5/mo, 1GB RAM)
- **Oracle Cloud** - FREE tier forever (1GB RAM)

## ğŸ“ˆ Performance

### Expected Performance
- **Latency**: +5-20ms vs direct connection
- **Speed**: 80-95% of server bandwidth
- **CPU**: Very low (<5% on modern CPU)
- **RAM**: ~50-100MB per instance

### Optimization Tips
```bash
# Enable BBR congestion control (Linux server)
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
```

## âš–ï¸ License

Same as Xray-core: MPL 2.0

---

## ğŸ‰ You're Ready!

Your Xray server is now:
- âœ… Production-ready
- âœ… Secure and encrypted
- âœ… Resistant to censorship
- âœ… Easy to manage
- âœ… Easy to share

**Start deploying:** `cd deploy/server/ && ./setup.sh`

**Questions?** Check DEPLOYMENT.md or open a GitHub issue.

---

**Happy proxying! ğŸš€**
